# EHKM: Efficient Hierarchical k-means

This repository contains a official implementation of **EHKM** (Efficient Hierarchical k-means), including:

- The main Python implementation of the EHKM algorithm.
- An optional **Cython-accelerated core** (`stage2_core`) for the most expensive inner loop (The `while` loop in Algorithm 2 in the paper). **When you need to execute a very large number of while loops (e.g., more than 10,000), it is recommended to use the cython acceleration approach.** Otherwise, the pure python version is sufficient


---

## Repository structure

- `EHKM.py`  
  Main implementation of the EHKM algorithm:
  - `EHKM(...)`: top-level function to run the algorithm.
  - `req_numclust_late_update(...)`: Algorithm 2 (late update for a requested number of clusters).
  - `stage2(...)`: core merging routine, with optional Cython backend support.

- `stage2_core.pyx`  
  Cython implementation of the inner merging loop (`merge_loop`), used to accelerate `stage2` when available.

- `setup.py`  
  Build script for compiling the Cython extension.

You can still use EHKM **without** compiling Cython; the code will automatically fall back to the pure Python implementation.

---

## Requirements

- Python 3.8+ (3.x is recommended)
- Required Python packages:
  - `numpy`
  - `scikit-learn` (for `metrics` and `NearestNeighbors`)
  - `pynndescent` (for `NNDescent`, used in the k-nearest neighbor calculation of large-scale datasets)
- Optional (for acceleration):
  - `Cython` (to compile `stage2_core.pyx`)

Install the dependencies, for example:

```bash
pip install numpy scikit-learn pynndescent cython
# Build the Cython extension in-place (optional)
python setup.py build_ext --inplace

```



